# OA 待办需求筛选任务说明

## 📋 任务目标

从 OA 系统"待办事宜"中**自动筛选并采集需求类待办项**，生成需求汇总报告。

---

## 🎯 核心改进

### 1. **需求筛选逻辑**

**之前**：采集所有待办项  
**现在**：只采集需求类待办项，非需求类跳过

### 2. **双重判断机制**

- **第一重**：标题关键词匹配
- **第二重**：详情页内容特征匹配

### 3. **自动分类**

Agent 会自动判断每条待办项是否为需求，并记录判断依据。

---

## 🔍 需求判断标准

### ✅ 满足任一条件即为需求：

1. **标题关键词**
   - 包含：需求、功能、开发、系统、平台、项目、应用、优化、新增

2. **发起人特征**
   - 由业务部门/用户/客户提交（非IT内部流程）

3. **内容特征**
   - 详情页包含：需求描述、功能说明、业务场景、用户故事、技术方案、开发计划

### ❌ 排除项（明确非需求）：

- 包含：周报、工时、考勤、报销、请假、培训、通知、公告

---

## 🔄 执行流程

```
登录 OA 系统
    ↓
进入"待办事宜"标签页
    ↓
循环处理每条待办项：
    ├─ 点击待办项 → 进入详情页
    ├─ 提取标题、发起人、内容关键词
    ├─ 执行需求判断（标题+内容双重）
    ├─ 如果是需求 → 采集详细信息
    ├─ 如果非需求 → 跳过，记录原因
    ├─ 返回待办列表
    └─ 继续下一条
    ↓
生成需求汇总报告
```

---

## 📊 生成报告内容

### 文件名：`oa_requirements_report.md`

### 报告结构：

1. **基本信息**
   - 采集时间
   - 待办总数
   - 需求数量
   - 筛选率

2. **需求列表（表格）**
   - 序号
   - 需求标题
   - 发起人
   - 发起时间
   - 需求描述
   - 附件
   - 优先级
   - 状态

3. **统计分析**
   - 基本统计（总数、需求数、非需求数、筛选率）
   - 需求分类（有/无附件、优先级分布）
   - 状态分布（待处理/进行中/已完成）

4. **筛选日志**
   - 已采集需求列表（含判断依据）
   - 已跳过非需求列表（含跳过原因）

---

## 🛠️ 技术实现

### 判断逻辑（伪代码）

```python
是否需求 = False

# 1. 排除明显非需求项
if 标题包含("周报", "工时", "考勤", "报销", "请假", "培训", "通知", "公告"):
    是否需求 = False
    跳过原因 = "非需求类流程"

# 2. 检查需求关键词（标题）
elif 标题包含("需求", "功能", "开发", "系统", "平台", "项目", "应用", "优化", "新增"):
    是否需求 = True
    判断依据 = "标题包含需求关键词"

# 3. 检查内容关键词（详情页）
elif 内容包含("需求描述", "功能说明", "业务场景", "用户故事", "技术方案", "开发计划"):
    是否需求 = True
    判断依据 = "内容包含需求特征"

# 4. 默认不是需求
else:
    是否需求 = False
    跳过原因 = "未匹配需求特征"
```

### Memory 记录

```
# 检查记录
已检查: [项目延期报告] - 需求: 否 - 非需求类流程
已检查: [XX系统开发需求] - 需求: 是 - 标题包含需求关键词

# 采集记录
已采集需求: [XX系统开发需求] - 发起人: 张三/业务部 - 时间: 2025-01-15
```

---

## 🚀 使用方法

### 1. 清理旧数据

```powershell
Remove-Item agent_output\browseruse_agent_data\* -Force -ErrorAction SilentlyContinue
```

### 2. 运行 Agent

```powershell
python my_custom_template.py
```

### 3. 查看结果

- **报告文件**：`agent_output/browseruse_agent_data/oa_requirements_report.md`
- **日志文件**：`logs/agent_run_*.log`

### 4. 验证点

- ✅ 终端输出中有 `💾 Data written to file oa_requirements_report.md successfully.`
- ✅ 报告文件存在且不为空
- ✅ 报告中只包含需求类待办项
- ✅ 筛选日志记录了判断依据和跳过原因

---

## 📝 配置说明

### 关键配置（`my_custom_template.py`）

```python
# LLM 模型
OPENAI_MODEL: str = 'o3'  # 或其他模型

# 限制输出长度，减少超时
MAX_TOKENS: Optional[int] = 800

# 最大执行步骤
MAX_STEPS: int = 30

# 每步超时时间
STEP_TIMEOUT: int = 180
```

---

## 🔧 故障排查

### 问题1：报告文件为空

**原因**：Agent 没有执行到"生成报告"步骤  
**解决**：查看日志，确认是否有 `💾` 标志

### 问题2：筛选不准确

**原因**：关键词匹配不完整  
**解决**：修改提示词中的关键词列表

### 问题3：超时错误

**原因**：LLM 思考时间过长  
**解决**：降低 `MAX_TOKENS` 或 `TEMPERATURE`

### 问题4：重复采集

**原因**：Memory 记录失效  
**解决**：检查 Memory 中的"已检查"记录

---

## 💡 优化建议

1. **关键词优化**
   - 根据实际业务调整需求关键词
   - 添加更多排除关键词

2. **判断逻辑优化**
   - 增加发起人部门判断
   - 增加流程类型字段判断

3. **报告格式优化**
   - 添加需求优先级排序
   - 添加需求来源分析（部门/客户）

4. **性能优化**
   - 使用更快的模型（如 gpt-4.1-mini）
   - 减少等待时间（从3秒改为2秒）

---

## 📚 相关文件

- **配置文件**：`my_custom_template.py`
- **诊断工具**：`diagnose_filesystem.py`
- **测试脚本**：`test_filesystem_write.py`
- **报告输出**：`agent_output/browseruse_agent_data/oa_requirements_report.md`

---

**最后更新**：2025-10-22  
**版本**：v2.0 - 需求筛选版
